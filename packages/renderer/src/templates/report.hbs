<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{clientName}} - {{periodLabel}} Performance Report</title>
  <style>
    {{{styles}}}
  </style>
</head>
<body>
  <div class="report">
    <!-- Header -->
    <header class="report-header">
      <h1>{{clientName}}</h1>
      <div class="period">{{periodLabel}} Performance Report</div>
      <div class="generated-at">Generated on {{generatedAtFormatted}}</div>
    </header>

    {{#if ga4}}
    <section class="section ga4-section">
      <div class="ga4-header">
        <h2 class="ga4-title">Google Analytics 4</h2>
        <div class="ga4-subtitle">User Acquisition</div>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-label">Sessions</div>
            <div class="kpi-change {{changeClass ga4.changes.sessions}}">
              {{formatChange ga4.changes.sessions}}
            </div>
          </div>
          <div class="kpi-value">{{formatNumber ga4.current.sessions}}</div>
          {{#if sparklineCharts.sessions}}
          <img class="sparkline" src="{{sparklineCharts.sessions}}" alt="Sessions trend" />
          {{/if}}
        </div>
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-label">Bounce Rate</div>
            <div class="kpi-change {{changeClass ga4.changes.bounceRate true}}">
              {{formatChange ga4.changes.bounceRate}}
            </div>
          </div>
          <div class="kpi-value">{{formatPercent ga4.current.bounceRate}}</div>
          {{#if sparklineCharts.bounceRate}}
          <img class="sparkline" src="{{sparklineCharts.bounceRate}}" alt="Bounce rate trend" />
          {{/if}}
        </div>
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-label">Page Views</div>
            <div class="kpi-change {{changeClass ga4.changes.pageviews}}">
              {{formatChange ga4.changes.pageviews}}
            </div>
          </div>
          <div class="kpi-value">{{formatNumber ga4.current.pageviews}}</div>
          {{#if sparklineCharts.pageviews}}
          <img class="sparkline" src="{{sparklineCharts.pageviews}}" alt="Page views trend" />
          {{/if}}
        </div>
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-label">Average Session Duration</div>
            <div class="kpi-change {{changeClass ga4.changes.avgSessionDuration}}">
              {{formatChange ga4.changes.avgSessionDuration}}
            </div>
          </div>
          <div class="kpi-value">{{formatDurationHms ga4.current.avgSessionDuration}}</div>
          {{#if sparklineCharts.avgSessionDuration}}
          <img class="sparkline" src="{{sparklineCharts.avgSessionDuration}}" alt="Session duration trend" />
          {{/if}}
        </div>
      </div>

      <div class="trend-grid">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title">Sessions</div>
            <div class="chart-value">{{formatNumber ga4.current.sessions}}</div>
          </div>
          {{#if sessionsTrendChart}}
          <img class="trend-chart" src="{{sessionsTrendChart}}" alt="Sessions trend" />
          {{/if}}
        </div>
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title">Total Users</div>
            <div class="chart-value">{{formatNumber ga4.current.users}}</div>
          </div>
          {{#if usersTrendChart}}
          <img class="trend-chart" src="{{usersTrendChart}}" alt="Users trend" />
          {{/if}}
        </div>
      </div>

      <div class="mid-grid">
        <div class="card sessions-by-channel">
          <div class="card-title">Sessions by Channel</div>
          {{#if channelsPieChart}}
          <div class="donut-chart">
            <img src="{{channelsPieChart}}" alt="Sessions by channel" />
          </div>
          {{/if}}
        </div>
        <div class="kpi-small-grid">
          <div class="kpi-card small">
            <div class="kpi-header">
              <div class="kpi-label">Active Users</div>
              <div class="kpi-change {{changeClass ga4.changes.activeUsers}}">
                {{formatChange ga4.changes.activeUsers}}
              </div>
            </div>
            <div class="kpi-value">{{formatNumber ga4.current.activeUsers}}</div>
            {{#if sparklineCharts.activeUsers}}
            <img class="sparkline" src="{{sparklineCharts.activeUsers}}" alt="Active users trend" />
            {{/if}}
          </div>
          <div class="kpi-card small">
            <div class="kpi-header">
              <div class="kpi-label">New Users</div>
              <div class="kpi-change {{changeClass ga4.changes.newUsers}}">
                {{formatChange ga4.changes.newUsers}}
              </div>
            </div>
            <div class="kpi-value">{{formatNumber ga4.current.newUsers}}</div>
            {{#if sparklineCharts.newUsers}}
            <img class="sparkline" src="{{sparklineCharts.newUsers}}" alt="New users trend" />
            {{/if}}
          </div>
          <div class="kpi-card small">
            <div class="kpi-header">
              <div class="kpi-label">User Engagement</div>
              <div class="kpi-change {{changeClass ga4.changes.userEngagementDuration}}">
                {{formatChange ga4.changes.userEngagementDuration}}
              </div>
            </div>
            <div class="kpi-value">{{formatDurationWords ga4.current.userEngagementDuration}}</div>
            {{#if sparklineCharts.userEngagementDuration}}
            <img class="sparkline" src="{{sparklineCharts.userEngagementDuration}}" alt="User engagement trend" />
            {{/if}}
          </div>
          <div class="kpi-card small">
            <div class="kpi-header">
              <div class="kpi-label">Engagement Rate</div>
              <div class="kpi-change {{changeClass ga4.changes.engagementRate}}">
                {{formatChange ga4.changes.engagementRate}}
              </div>
            </div>
            <div class="kpi-value">{{formatPercent ga4.current.engagementRate}}</div>
            {{#if sparklineCharts.engagementRate}}
            <img class="sparkline" src="{{sparklineCharts.engagementRate}}" alt="Engagement rate trend" />
            {{/if}}
          </div>
        </div>
      </div>

      <div class="bottom-grid">
        <div class="card pageviews-card">
          <div class="card-title">Page Views</div>
          {{#if pageViewBars.length}}
          <div class="pageviews-list">
            {{#each pageViewBars}}
            <div class="pageview-row">
              <div class="pageview-path">{{path}}</div>
              <div class="pageview-bar">
                <div class="pageview-fill" style="width: {{percent}}%"></div>
              </div>
              <div class="pageview-value">{{formatNumber views}}</div>
            </div>
            {{/each}}
          </div>
          {{else}}
          <div class="no-data">No page view data available for this period.</div>
          {{/if}}
        </div>
        <div class="keyevents-grid">
          {{#if keyEventDonuts.length}}
          {{#each keyEventDonuts}}
          <div class="card keyevent-card">
            <div class="card-title">{{formatEventLabel name}}</div>
            <div class="donut-chart">
              <img src="{{chart}}" alt="{{formatEventLabel name}} breakdown" />
            </div>
          </div>
          {{/each}}
          {{else}}
          <div class="no-data">No key event data available for this period.</div>
          {{/if}}
        </div>
      </div>
    </section>
    {{else}}
    <!-- No GA4 Data -->
    <section class="section">
      <div class="no-data">
        <p>No Google Analytics data available for this report.</p>
        <p>Please connect a Google Analytics property to this client to generate metrics.</p>
      </div>
    </section>
    {{/if}}

    <!-- Footer -->
    <footer class="report-footer">
      <p>Report generated by Agency Reports Platform</p>
      <p>Data period: {{periodStart}} to {{periodEnd}}</p>
    </footer>
  </div>
</body>
</html>
